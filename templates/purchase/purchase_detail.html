{% extends "tenant.html" %}

{% block content %}
<div class="container mt-4">
  <!-- Breadcrumb for navigation context -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'purchase:purchase_invoice_list' %}">Purchase Listing</a></li>
      <li class="breadcrumb-item active" aria-current="page">Purchase Detail</li>
    </ol>
  </nav>

  <!-- Page Header -->
  <div class="row mb-4">
    <div class="col">
      <h1 class="display-4">Purchase Detail</h1>
    </div>
  </div>

  <!-- Action Buttons -->
  <p>
    <a class="btn btn-primary" href="{% url 'purchase:purchase_invoice_list' %}">Purchase Listing</a>
    <a class="btn btn-secondary" href="">Print</a>
    <a class="btn btn-primary" href="{% url 'purchase:purchase_invoice_update' object.id%}">Edit</a>
    <a class="btn btn-danger" href="{% url 'purchase:purchase_invoice_delete' object.id %}">Delete</a>
  </p>

  <!-- Navigation Buttons -->
  <div class="btn-group justify-content-between" role="group" aria-label="Basic example">
    {% if previous %}
    <a href="{% url 'purchase:purchase_invoice_detail' previous.pk %}" type="button" class="btn btn-primary mr-2">Previous {{previous.id}}</a>
    {% endif %}
    {% if next %}
    <a href="{% url 'purchase:purchase_invoice_detail' next.id %}" type="button" class="btn btn-primary mr-2">Next {{next.id}}</a>
    {% endif %}
  </div>

  <div class="row mt-4">
    <!-- Purchase Information Card -->
    <div class="col-md-3">
      <div class="card bg-light mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="card-title mb-0">Purchase Details</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-12">
              <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>ID:</strong> <span>{{object.id}}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Supplier:</strong> <span>{{object.supplier}}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Created:</strong> <span>{{object.created}}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Updated:</strong> <span>{{object.updated}}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Status:</strong> <span>{{object.status}}</span>
                </li>
              </ul>
            </div>
            <div class="col-md-12 mt-3">
              <h6 class="card-subtitle mb-2 text-muted">Weights and Rates</h6>
              <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Gross Wt:</strong> <span>{{object.get_gross_wt}}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Net Wt:</strong> <span>{{object.get_net_wt}}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Ratecut:</strong> <span>{{object.is_ratecut}}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>GST:</strong> <span>{{object.is_gst}} / {{object.get_gst}}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Balance:</strong> <span>{{object.get_balance}}</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Paid:</strong> <span>{{object.get_allocations}}</span>
                </li>
              </ul>
            </div>
            <div class="col-md-12 mt-3">
              <h6 class="card-subtitle mb-2 text-muted">Options</h6>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="ratecutSwitch"
                  {% if object.is_ratecut %} checked {% endif %}
                  hx-post="{% url 'purchase:purchase_ratecut_change' object.id %}">
                <label class="form-check-label" for="ratecutSwitch">Ratecut</label>
              </div>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="gstSwitch"
                  {% if object.is_gst %} checked {% endif %}
                  hx-post="{% url 'purchase:purchase_gst_change' object.id %}">
                <label class="form-check-label" for="gstSwitch">is_gst</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Menu -->
    <div class="col-md-9">
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="purchase-items-tab" data-bs-toggle="tab" data-bs-target="#purchase-items" type="button" role="tab" aria-controls="purchase-items" aria-selected="true">Purchase Items</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="payments-tab" data-bs-toggle="tab" data-bs-target="#payments" type="button" role="tab" aria-controls="payments" aria-selected="false">Payments</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="journals-tab" data-bs-toggle="tab" data-bs-target="#journals" type="button" role="tab" aria-controls="journals" aria-selected="false">Transactions</button>
        </li>
      </ul>
      <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="purchase-items" role="tabpanel" aria-labelledby="purchase-items-tab">
          <div class="table-responsive">
            <a hx-get="{% url 'purchase:purchase_invoiceitem_create' object.id %}" hx-target="#items" hx-swap="beforeend" class="btn btn-primary">Add Items</a>
            <table class="table table-sm table-striped table-bordered">
              <thead class="thead-dark">
                <tr>
                  <th>huid</th>
                  <th>Product</th><th>Qty</th><th>Weight</th>
                  <th>Touch</th><th>Net_wt</th><th>MC</th><th>Balance</th>
                </tr>
              </thead>
              <tbody id="items" hx-target="closest tr" hx-swap="outerHTML">
                {% for i in object.purchase_items.all %}
                {% include 'purchase/item-inline.html' with object=i %}
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        <div class="tab-pane fade" id="payments" role="tabpanel" aria-labelledby="payments-tab">
          {% if object.paymentallocation_set %}
          <table class="table table-sm table-striped table-bordered">
            <thead class="thead-dark">
              <tr>
                <th>Payment</th><th>Created</th><th>Amount</th>
              </tr>
            </thead>
            {% for i in object.paymentallocation_set.all %}
            <tr>
              <td><a href="{% url 'purchase:purchase_payment_detail' i.payment.id %}">{{i.payment.id}}</a></td>
              <td>{{i.created}}</td>
              <td>{{i.allocated}}</td>
            </tr>
            {% endfor %}
          </table>
          {% endif %}
        </div>
        <div class="tab-pane fade" id="journals" role="tabpanel" aria-labelledby="journals-tab">
          {% include 'dea/txns.html' with object=je%}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
